- case: typeclass_definition_any
  disable_cache: false
  main: |
    from classes import typeclass

    @typeclass
    def example(instance):
        ...


- case: typeclass_definied_by_type
  disable_cache: false
  main: |
    from classes import typeclass, AssociatedType

    class ToJson(AssociatedType):
        ...

    @typeclass(ToJson)
    def to_json(instance, verbose: bool = False) -> str:
        ...

    @to_json.instance(int)
    def _to_json_int(instance: int, verbose: bool = False) -> str:
        return str(instance)

    @to_json.instance(str)
    def _to_json_str(instance: str, verbose: bool = False) -> str:
        return instance

    to_json(1, verbose=True)
    to_json('a')
    to_json(None)
  out: |
    main:20: error: Argument 1 to "to_json" has incompatible type "None"; expected "Supports[ToJson]"


- case: typeclass_class_wrong_sig
  disable_cache: false
  main: |
    from classes import typeclass, AssociatedType

    class ToJson(AssociatedType):
        ...

    @typeclass(ToJson)
    def to_json(instance, verbose: bool = False) -> str:
        ...

    @to_json.instance(int)
    def _to_json_int(instance: str) -> int:
        ...
  out: |
    main:10: error: Instance "builtins.str" does not match runtime type "builtins.int*"
    main:10: error: Instance callback is incompatible "def (instance: builtins.str) -> builtins.int"; expected "def (instance: builtins.str, verbose: builtins.bool =) -> builtins.str"


- case: typeclass_definied_by_wrong_type
  disable_cache: false
  main: |
    from classes import typeclass

    class ToJson(object):
        ...

    @typeclass(ToJson)
    def to_json(instance, verbose: bool = False) -> str:
        ...
  out: |
    main:6: error: Single direct subclass of "classes._typeclass.AssociatedType" required; got "main.ToJson"


- case: typeclass_definied_by_multiple_parents
  disable_cache: false
  main: |
    from classes import typeclass, AssociatedType

    class A(object):
        ...

    class ToJson(AssociatedType, A):
        ...

    @typeclass(ToJson)
    def to_json(instance, verbose: bool = False) -> str:
        ...
  out: |
    main:9: error: Single direct subclass of "classes._typeclass.AssociatedType" required; got "main.ToJson"


- case: typeclass_definied_by_literal
  disable_cache: false
  main: |
    from classes import typeclass

    typeclass(1)
  out: |
    main:3: error: No overload variant of "typeclass" matches argument type "int"
    main:3: note:     def [_AssociatedType] typeclass(definition: Type[_AssociatedType]) -> _TypeClassDef[_AssociatedType]
    main:3: note:     def [_SignatureType, _InstanceType, _AssociatedType, _Fullname <: str] typeclass(signature: _SignatureType) -> _TypeClass[_InstanceType, _SignatureType, _AssociatedType, _Fullname]
    main:3: note: Possible overload variants:
